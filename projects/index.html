<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">

    <meta name="author" content="SÖREN SCHNEIDER">
    <meta name="description" content="Cool stuff at work Google IAP Kubernetes Controller To allow an uncomplicated exposal of Kubernetes services via a secured Google Identity Aware Proxy, we wrote a Kubernetes Controller that solely works on appropriate labels on the K8s service resources. To be 100% sure that the service is not being exposed publicly (in case Google IAP has trouble), an envoy proxy is injected as a sidecar that performs mandatory JWT verification.">
    <meta name="keywords" content="blog,developer,personal">

    

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Projects"/>
<meta name="twitter:description" content="Cool stuff at work Google IAP Kubernetes Controller To allow an uncomplicated exposal of Kubernetes services via a secured Google Identity Aware Proxy, we wrote a Kubernetes Controller that solely works on appropriate labels on the K8s service resources. To be 100% sure that the service is not being exposed publicly (in case Google IAP has trouble), an envoy proxy is injected as a sidecar that performs mandatory JWT verification."/>

    <meta property="og:title" content="Projects" />
<meta property="og:description" content="Cool stuff at work Google IAP Kubernetes Controller To allow an uncomplicated exposal of Kubernetes services via a secured Google Identity Aware Proxy, we wrote a Kubernetes Controller that solely works on appropriate labels on the K8s service resources. To be 100% sure that the service is not being exposed publicly (in case Google IAP has trouble), an envoy proxy is injected as a sidecar that performs mandatory JWT verification." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.soerenschneider.com/projects/" />
<meta property="article:published_time" content="2019-10-18T09:37:50+02:00" />
<meta property="article:modified_time" content="2019-10-18T09:37:50+02:00" />


    
      <base href="https://www.soerenschneider.com/projects/">
    
    <title>
  Projects · soerenschneider
</title>

    
      <link rel="canonical" href="https://www.soerenschneider.com/projects/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css" integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://www.soerenschneider.com/css/coder.min.3219ef62ae52679b7a9c19043171c3cd9f523628c2a65f3ef247ee18836bc90b.css" integrity="sha256-MhnvYq5SZ5t6nBkEMXHDzZ9SNijCpl8&#43;8kfuGINryQs=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="https://www.soerenschneider.com/css/extra-style.css" />
    

    

    <link rel="icon" type="image/png" href="https://www.soerenschneider.com/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://www.soerenschneider.com/images/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.74.3" />
  </head>

  
  
  <body class="colorscheme-light"
        onload=""
  >
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://www.soerenschneider.com/">
      soerenschneider
    </a>
    
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.soerenschneider.com/about/">ABOUT</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.soerenschneider.com/projects/">PROJECTS</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.soerenschneider.com/cv/">CV</a>
          </li>
        
      
      
    </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>Projects</h1>
    </header>

    <h1 id="cool-stuff-at-work">Cool stuff at work</h1>
<h3 id="google-iap-kubernetes-controller">Google IAP Kubernetes Controller</h3>
<p>To allow an uncomplicated exposal of Kubernetes services via a secured Google Identity Aware Proxy, we wrote a Kubernetes Controller that solely works on appropriate labels on the K8s service resources. To be 100% sure that the service is not being exposed publicly (in case Google IAP has trouble), an <a href="https://www.envoyproxy.io/">envoy proxy</a> is injected as a sidecar that performs mandatory JWT verification.</p>
<h3 id="synchronizing-secrets-from-hashicorp-vault">Synchronizing secrets from Hashicorp Vault</h3>
<p>We wrote a critical component that reads secrets from Hashicorp Vault and synchronizes them unidirectionally to interchangeable backend. It is possible to consume (re-read) a certain secret on each interval or reading the secret once and extending its lease variably before its expiry. The provided backends currently support writing the secret as a Kubernetes secret and writing as a file on Cloud Storage bucket.</p>
<h3 id="graceful-pod-killer">Graceful Pod Killer</h3>
<blockquote>
<p>There are 2 hard problems in computer science: cache invalidation, naming things, and off-by-1 errors</p>
</blockquote>
<p>I wrote a tool that is able to safely restart targeted Deployments. Targets can be auto-discovered by (multiple) labels, a certain secret they have mounted and/or their start date. After killing a pod, it waits until the replica is healthy again to continue with the next pod in line. This tool comes in handy for controlled chaos engineering operations or when you need to restart pods to force the consumption of an updated secret.</p>
<h3 id="automatically-verifying-cloud-sql-backups">Automatically verifying Cloud SQL backups</h3>
<p>On more than one occasion we were facing incidents with Cloud SQL instances that got into a bad state and whose last <em>n</em> out of <em>m</em> backups were unusable. We decided to build a product using multiple Cloud Functions that automatically restores new Cloud SQL backups, verifies them, cleans up everything and notifies the owning team in case of problems.</p>
<h3 id="get-notified-on-outdated-docker-images-in-kubernetes">Get notified on outdated Docker images in Kubernetes</h3>
<p>During several &lsquo;Learning Friday&rsquo; sessions I wrote a POC that checks whether running pods use outdated docker images. To inspect a cluster, an agent is deployed that gathers the needed information via internal Kubernetes API calls and reports back via Pub Sub to the master. In the master, the docker image string is disassembled. After that, a call against the appropriate image registry&rsquo;s API is performed, checking out the available versions and writes the information to a SQL database. Versions were compared and on a version skew, teams were notified via prometheus.</p>
<h3 id="cloud-functions-metrics-exporter">Cloud Functions metrics exporter</h3>
<p>When using Cloud Functions we wanted to be able to use fine-grained monitoring for our functions. Due to the nature of Cloud Functions still being early beta, it wasn&rsquo;t possible to peer them to our GKE network. Therefore we weren&rsquo;t able to use Prometheus Pushgateway (as it is exposed only inside the clusters) or scrape them like regular targets (due to their low runtime, networking, &hellip;).</p>
<p>As the functions were all triggered using Pub Sub, we decided to write a Prometheus exporter that receives metrics in raw Prometheus text format dispatched via Pub Sub once the function finished.</p>
<h3 id="aws-cloud-architecture--migration">AWS Cloud Architecture &amp; Migration</h3>
<p>The most challenging task undoubtedly was planning and migrating to the cloud architecture at AWS. Due to multiple constellations, the end date of the migration was already known before real planning started. After <em>a lot</em> of small, nightly iterations the transition was done, but not the work. The initial move involved almost only manual work, after the move to AWS I started to replicate the environment using IAC.</p>
<p>With an ever increasing size of both team members and services, conflicts of the monolithic architecture became apparent. The first container orchestration used, was ECS. Due to its nature, being as dull as solid, it is the ideal solution for understaffed departments. Later on, there was the big shift towards a kops-created Kubernetes, unfortunately operated only by me.</p>
<h3 id="business-partner-data-curation">Business Partner Data Curation</h3>
<p>Concept and realization of an easily configurable, high-performance concurrent service that improves business partner data. The data was read from a queue, ran through several <em>curation elements</em> and was written to a new MongoDB collection. The list of elements and their order was dymanic and interchangable. A single data element could take various paths down the curator based on its attributes, e.g. a certain country, a certain &ldquo;legal form&rdquo;. A curation element could alter (e.g. transliteration) and also flag (e.g. &ldquo;legal form is invalid for given country&rdquo;) data. Several permutations of configuration could be performed, to find the best settings for input data.</p>
<h3 id="providing-scalable-enterprise-ready-semantic-mediawiki-stacks">Providing scalable, enterprise-ready Semantic MediaWiki stacks</h3>
<p>Using both CloudFormation and Ansible I was able to roll-out a scalable <a href="https://www.semantic-mediawiki.org/wiki/Semantic_MediaWiki">Semantic Media Wiki</a> providing Single Sign On capabilities with few effort. The resulting VMs were part of Auto Scaling Groups and were backed by Docker images. SPARQL queries were answered by an Apache Fuseki.</p>
<h1 id="private-projects">Private projects</h1>
<h3 id="bootstrapping-my-environment">Bootstrapping My Environment</h3>
<p>You got your dotfiles checked in git repository? That&rsquo;s cool, but that doesn&rsquo;t really cut it for me, personally. There&rsquo;s still no packages installed. What about secrets? What about different configuration for different machines?</p>
<p>I securely bootstrap my whole environment within a couple of minutes, only using my personal nitrokey, <a href="https://gitlab.com/soerenschneider/bootstrap">an ansible playbook and a little bit of shell script</a>. All dotfiles are checked out &amp; linked, software is being compiled, all packages installed and local passwords are safely initialized.</p>
<h3 id="notification-on-late-trams">Notification on Late Trams</h3>
<p>Living in Cologne you&rsquo;ll realize the local public transportation company enjoys being spontaneous. Its <a href="https://kvb.koeln/service/open_data.html">&ldquo;OpenData&rdquo;</a> is more static than melting ice caps, so we need to fetch, parse and process the interesting bits ourselfes. There are 4 microservices that communicate via loosely coupled streams based on redis. Did someone say &lsquo;over-engineered&rsquo;? Maybe, but it was a fun project!</p>
<ul>
<li><a href="https://gitlab.com/soerenschneider/kfailb-scraper">scraping tram data</a></li>
<li><a href="https://gitlab.com/soerenschneider/kfailb-parser">parsing scraped data</a></li>
<li><a href="https://gitlab.com/soerenschneider/kfailb-bot">deduplication and notifying on late tram via telegram bot</a></li>
<li><a href="https://gitlab.com/soerenschneider/k-fail-banal">storing data long term</a></li>
</ul>
<h3 id="home-automation">Home Automation</h3>
<p>&ldquo;<em>I paid a lot of bucks for home automation and all I got is this lousy t-shirt</em>&rdquo;. Sounds familiar? Alternatively, you can do it yourself using Open Source components, which is super fun. I built some projects to read sensor data from my Raspberry Zero &amp; Arduino fleet, streaming it via MQTT and exposing metrics. Metrics allow both observability and also alerting on sensor data, e.g. humidity.</p>
<ul>
<li><a href="https://gitlab.com/soerenschneider/pir-motion-raspberry">reading motion sensor data</a></li>
<li><a href="https://gitlab.com/soerenschneider/mqtt-tempsensor">reading temperature sensor data</a></li>
<li><a href="https://gitlab.com/soerenschneider/serial-sensor-reader">reading arbitrary analog sensor data over serial line</a>.</li>
<li><a href="https://gitlab.com/soerenschneider/rc-switch-mqtt">executing commands via mqtt/home assistant switch</a></li>
</ul>
<h3 id="automate-boring-stuff">Automate Boring Stuff</h3>
<p>One downside of running (a lot of) self-hosted services is the resulting overhead of keeping everything running and secure. My ambition is to run and maintain all these (decentral) workloads with as little manual intervention as possible. Therefore I wrote <a href="https://gitlab.com/soerenschneider/ansible-roles">plenty of Ansible roles</a>, terraform modules and a small release management tool to automate <em>almost</em> everything. Thanks to automation, replacing cattle became an easy, fast and safe task.</p>
<h3 id="oberservability">Oberservability</h3>
<p>Automation is nice, but all the VMs and machines, running at different physical locations also need observability. Currently, each location is running its own prometheus stack &amp; grafana, but there&rsquo;s plans to use a centralized solution to send alerts from, such as <a href="https://github.com/cortexproject/cortex">cortex</a> or <a href="https://github.com/thanos-io/thanos">thanos</a>. I also wrote some KISS prometheus exporters, most of them using the node_exporter textfile functionality.</p>
<ul>
<li><a href="https://gitlab.com/soerenschneider/grafana">immutable grafana</a></li>
<li><a href="https://gitlab.com/soerenschneider/mtail-programs">mtail programs</a></li>
<li><a href="https://gitlab.com/soerenschneider/dhcpd-leases-exporter">dhcpd exporter</a></li>
<li><a href="https://gitlab.com/soerenschneider/fail2ban-exporter">fail2ban exporter</a></li>
<li><a href="https://gitlab.com/soerenschneider/prometheus-rules">prometheus rules</a></li>
<li><a href="https://gitlab.com/soerenschneider/ansible-roles/-/blob/master/dullmonitor/files/dullmonitor">monitoring the prometheus stack</a></li>
<li>&hellip;</li>
</ul>
<h3 id="selinux-modules">SELinux Modules</h3>
<p>You also believe people that recommend the first thing to do after booting up a RHEL is to disable SELinux are whiny losers? <a href="https://gitlab.com/soerenschneider/traefik-selinux">You&rsquo;re</a> <a href="https://gitlab.com/soerenschneider/prometheus-selinux">god</a> <a href="https://gitlab.com/soerenschneider/transmission-selinux">damn</a> <a href="https://gitlab.com/soerenschneider/taskd-selinux">right</a> ;-)</p>
<h3 id="bootstrapping-my-openbsd-router">Bootstrapping my OpenBSD router</h3>
<p>Also using an Ansible playbook, I&rsquo;m able to bootstrap my OpenBSD-based router running on an <a href="https://www.pcengines.ch/apu2.htm">APU2</a> within a couple of minutes.</p>
<ul>
<li>Use a model (configuration as code) to build complex firewall rules, DNS entries and entire network configuration</li>
<li>Observability using prometheus and custom exporters</li>
<li>DNS adblocking with continous updates, similar to Pihole</li>
<li>Self-made dynamic DNS implementation using AWS Route53 and AWS Lambda</li>
<li>Traffic shaping</li>
</ul>

  </article>
</section>

  

      </div>

      
  <footer class="footer">
    <section class="container">
      
      
        ©
        
        2020
         SÖREN SCHNEIDER 
      
      
      
    </section>
  </footer>

    </main>

    

    

    

  </body>

</html>
